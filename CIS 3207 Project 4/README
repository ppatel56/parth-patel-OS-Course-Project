Parth Patel
12/05/2019
CIS 3207 - Section 2
Project 4 - Simple File System

Introduction:

The goal of the project is to implement a simple file system on top of a virtual disk. The program will use quite a few system calls
such as open, read, and write.

The virtual disk is actually a single file that is stored on the "real" file system provided by the OS. 

Two files were provided to us to help create, open, close a disk as well as read and write blocks in the virtual disk. The files were
disk.c and disk.h.

The disk has 16,384 blocks and half of that was for FAT and the other for data section for metadata information. There could only be 256 
files with each file being only 4096 (4KB).



Implementation:

The project required to make a set of functions to manipulate files and directories on the virtual disk. 

int make_fs(char* disk_name);

int mount_fs(char* disk_name);

int unmount_fs(char* disk_name);

int fs_open(char* name);

int fs_close(int fildes);

int fs_create(char *name);

int fs_delete(char* name);

int fs_mkdir(char* name);

int fs_read(int fildes, void* buf, size_t nbyte);

int fs_write(int fildes, void* buf, size_t nbyte);

int fs_get_filesize(int fildes);

int fs_lseek(int fildes, off_t offset);

int fs_truncate(int fildes, off_t offset);


The project required the use of structs, mainly the directory entry and FAT. I ended up with 6 typedef structs such as FAT, Entry, directory,
fileEntry, dataBlocks, and DATA. 

The FAT struct contained the fileEntry array so each file entry would be kept tracked by the FAT, and the fileEntry only contained status and
next block. The Entry had the metadata information of the directory entry such as name or file size. The directory struct contained an array
of Entries. The dataBlock was an array of section and the DATA was an array of dataBlock.


Testing:
The testing processes involved getting used to the structs and see what stuff works with regards to how to manipulate the files. There were
some revisions with the struct in order to make sense of what was going on with the project. Then there was spending some time trying to get 
used to using the disk.c functions especially the block_read and block_write functions. The fs_write and fs_read were pretty difficult to 
make since the functions were about determining the size of the buffers that were passed into the functions, and also trying to block_write
or block_read the functions were very difficult. At times the fs_write would write the error message into the disk, thus filling up quite a few
space. Most of the other functions were a bit easier such as creating file/directory as most would use the same approach. It was a matter of 
getting to understand the struct Implementation.

There were also many helper functions used to get the available free blocks in the FAT, find a file entry, find available entries, get the offset
of the file. I also had a change directory function since I imported functions from myshell.c such as the paraser function, shell prompt,
buitInCommand. There was also a directory stack for the change directory function and also had the typical stack functions made.


Problems:
The main problems that I have occured are the mount_fs and unmount_fs functions. I haven't done the mount_fs functions due time and also 
becuase of the way that my structs are implemente, it's more difficult or confusing to unmount_fs as I don't know how to properly unmount_fs the 
file system due the directory entries being limited by MAX_ENTRIES. I tried to store the metadata of directory entry into a C++ string and then
wanted to parse the metadata approriately and put them into the mount_fs. I also don't have fs_lseek and fs_truncate since I didn't have the
time to work on them or to properly understand how they worked.